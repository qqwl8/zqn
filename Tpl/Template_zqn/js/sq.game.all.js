!function($,SQ,undefined){if(window.bHTTPSEnabled=0,!(!SQ||SQ.Login&&SQ.Login.version)){$(document).ready(function(){$(document.body).append('<img src="https://my.37.com/httpsEnable.gif?t='+(new Date).getTime()+'" width="0" height="0" style="display:block;" onerror="javascript:window.bHTTPSEnabled=false;" onload="javascript:window.bHTTPSEnabled=true;" />')});var L,TL,tl,VC,loc=window.location,abrefer="",verifyCode="",isLogin=!1,$head=$(document.head||document.getElementsByTagName("head")[0]);TL=new SQ.Class,TL.include({init:function(a){var b=this.options=$.extend(!0,{dialog:!1,dialogOpts:{},adrefer:"",gameid:0,logBox:null,vcOption:{},lr:$.noop,loged:$.noop,unlog:$.noop,reged:$.noop,unreg:$.noop,out:$.noop,unout:$.noop,fail:$.noop,timeout:$.noop},a);if(b.dialog&&(this.dialog=new SQ.Login.Dialog($.extend({},b.dialogOpts))),b.gameid&&(L.logInfo.gameid=L.regInfo.gameid=b.gameid),(b.abrefer||b.adrefer)&&(abrefer=b.abrefer||b.adrefer),b.logBox){b.vcOption.logBox=b.logBox=$(b.logBox);var c=this.vc=new VC(b.vcOption);L.bind("unlog",function(a,b){"log"===b&&"safe_true"===a.data&&(c.isOpen?c.refreshImg():c.open())})}L.bind("loged",b.loged),L.bind("loged",b.lr),L.bind("unlog",b.unlog),L.bind("reged",b.reged),L.bind("reged",b.lr),L.bind("unreg",b.unreg),L.bind("out",b.out),L.bind("unout",b.unout),L.bind("fail",b.fail),L.bind("timeout",b.timeout)},toLog:function(a,b,c,d){var e,f;if(d){if((e=SQ.Login.checkUsername(a))!==!0)return L.alert(e);if((f=SQ.Login.checkPassword(b,!0))!==!0)return L.alert(f)}return L.toLog.call(L,"string"==typeof a?{login_account:a,password:b,save_state:c}:a)},toReg:function(a,b,c,d){var e,f;if(d){if((e=SQ.Login.checkUsername(a,!0))!==!0)return L.alert(e);if((f=SQ.Login.checkPassword(b))!==!0)return L.alert(f);if(b!==c)return L.alert("两次输入的密码不一致")}return L.toReg.call(L,"string"==typeof a?{login_account:a,password:b,password1:c}:a)},toOut:function(){return L.toOut.apply(L,arguments)},getUserInfo:function(){return L.getUserInfo.apply(L,arguments)},hasLogin:function(){return L.hasLogin()},bind:function(a,b){L.bind(a,b)}}),L=SQ.Login=function(a){return tl||(tl=new TL(a))},$.extend(L,{version:"1.2.2",logUrl:"https://my.37.com/api/login.php",regUrl:"https://my.37.com/api/register.php",outUrl:"http://my.37.com/api/login.php?action=logout",infoUrl:"http://my.37.com/api/login.php?action=userinfo",codeUrl:"http://my.37.com/code.php",existAccountUrl:"http://my.37.com/api/register.php?action=checkUser",checkWordsUrl:"http://my.37.com/api/check_words.php?action=check",loginPageUrl:"http://my.37.com/login.html",verifyUrl:"http://my.37.com/api/register.php?action=isOpenVerify&callback=?",css:{dialog:'<style type="text/css">.r-cover {display:none;overflow:hidden;z-index:100;width:100%;position:absolute;left:0;top:0;height:100%;background:#000;opacity:0.5;filter:alpha(opacity=50);}.r-dialog {display:none;top:40px;padding-top:27px;_padding-top:25px;border:1px solid #bbc9d4;z-index:101;width:393px;font-size:14px;border-radius:2px;position:absolute;left:50%;margin-left:-196px;background:#fff url(http://img1.37wanimg.com/www/css/images/common/bg-dialog-banner.jpg) no-repeat;}.r-dialog .ico {vertical-align:middle;}.r-dialog-t {border-bottom:1px solid #a1bdc4;}.r-dialog-t .r-dialog-t-f {margin-left:125px;}.r-dialog-t li {float:left;margin-left:10px;_display:inline;}.r-dialog-t a {color:#007596;display:block;height:20px;background-color:#98e5f4;border:1px solid #b7ccd0;border-bottom:none;padding:6px 30px;border-top-left-radius:1px;border-top-right-radius:1px;_display:inline-block;}.r-dialog-t .focus, .r-dialog-t a:hover {text-decoration:none;background-color:#fff;border-color:#acc6cd;}.r-dialog-t .focus {position:relative;top:1px;cursor:default;color:#006388;}.r-dialog-text {font-size:16px;color:#4e4e4c;border:1px solid #d0dcde;background-color:#e9f8ff;padding:3px 5px;width:214px;border-radius:2px;}.r-dialog-text:focus {border:1px solid #00e7ff;box-shadow:inset 0 0 4px #d6e5ea;}.r-dialog-text-error {border-color:#efb7bc;}.r-dialog-text-error:focus{border-color:#f78690;box-shadow:inset 0 0 2px #efb7bc;background-color:#ecd5db;}.r-dialog-panel{display:none;position:relative;padding:10px 20px;}.r-dialog-panel-log .r-dialog-tip{color:#f00;}.r-dialog-panel-log p {margin-bottom:13px;}.r-dialog-panel-log .r-right {width:73px;}.r-dialog .btn-s-2 {margin-top:5px;}.r-right {display:inline-block;width:83px;text-align:right;margin-right:12px;font-family:SimSun;}.r-dialog-panel-reg{padding-top:25px;padding-bottom:23px;}.r-dialog-tip-error{color:#f00;}.r-dialog-panel .r-dialog-tip {height:17px;font-family:SimSun;margin-left:95px;margin-bottom:2px;}.r-dialog-panel-log .r-dialog-tip{margin-left:85px;font-size:12px;padding-bottom:5px;padding-top:10px;}.r-dialog-panel-reg .r-dialog-tip{font-size:12px;margin-bottom:5px;}.r-dialog-keep {font-size:12px;margin-left:85px;margin-right:78px;cursor:pointer;*margin-left:82px;*margin-right:73px;}.r-dialog .r-dialog-forget{font-size:12px;color:#46a9f2;}.r-dialog-close {right:3px;top:-2px;font:16px "Comic Sans MS", Arial, Helvetica, sans-serif;position:absolute;transition:0.3s;color:#006fd3;text-align:center;}.r-dialog-close:hover {text-decoration:none;color:#ffa500;}.r-dialog-protocol{text-indent:50px;}.r-dialog-protocol label{cursor:pointer;}.r-dialog-protocol a{color:#46a9f2}.r-checkbox{margin-left:0;position:relative;top:-1px;margin-right:2px;}.r-dialog-ico{display:inline-block;width:16px;height:16px;position:relative;top:4px;left:10px;*top:-1px;_top:3px;}.r-dialog-ico-error,.r-dialog-ico-right{background:transparent url(http://img1.37wanimg.com/www/css/images/common/ico.png) no-repeat;}.r-dialog-ico-error{background-position:0 -679px;}.r-dialog-ico-right{background-position:0 -659px;}.r-dialog-ico-pending{background:transparent url(http://img1.37wanimg.com/www/css/images/common/loading-16x16.gif) no-repeat;}.r-dialog-verify-img{vertical-align:middle;cursor:pointer;width:71px;height:28px;}</style>',dialogEx:'<style>.r-dialog{margin:0;padding:0;color:#667382;font-family:"Microsoft Yahei",Arial,Helvetica,sans-serif;}.r-dialog input{outline:none;vertical-align:middle;}.r-dialog a{text-decoration:none;color:#667382;}.r-dialog a:hover{text-decoration:underline;color:#667382;}.r-dialog-t{list-style:none;zoom:1;}.r-dialog-t:after{content:"";display:block;font-size:0;clear:both;}.r-dialog .ac{text-align:center;}.r-dialog .btn{width:145px;display:inline-block;text-align:center;overflow:hidden;height:44px;line-height:44px;color:#4e4e4c;font-size:18px;vertical-align:middle;background:transparent url(http://img1.37wanimg.com/www/css/images/common/btn-24.png) 0 -527px;_background-image:url(http://img1.37wanimg.com/www/css/images/common/btn.png);}.r-dialog .btn:hover{background-position:0 -572px;text-decoration:none;}</style>'},tpl:{dialog:'<div class="r-cover" id="r-cover"></div><div id="r-dialog" class="r-dialog"><a href="#" title="关闭" class="r-dialog-close">X</a><ul class="r-dialog-t cf"><li class="r-dialog-t-f"><a data-order="0" href="#">用户登录</a></li><li><a data-order="1" href="#">用户注册</a></li></ul><div class="r-dialog-panel r-dialog-panel-log"><p class="r-dialog-tip"></p><p><label class="r-right" for="r-username">帐号</label><input name="login_account" type="text" class="r-dialog-text" data-rule="username" id="r-username" /></p><p data-vc><label class="r-right" for="r-password">密码</label><input name="password" type="password" class="r-dialog-text" data-rule="password" id="r-password" /></p><p><label class="r-dialog-keep" for="r-dialog-keep"><input name="save_state" id="r-dialog-keep" class="r-checkbox" checked type="checkbox" />下次自动登录</label><a title="找回密码" class="r-dialog-forget" target="_blank" href="http://my.37.com/forgetpwd/">忘记密码？</a></p><p class="ac"><a href="#" id="tj-r-btn-log" class="btn btn-s-2">马上登录</a></p><div class="sq-qr sq-qr-top" id="sq-qr-top"></div></div><div class="r-dialog-panel r-dialog-panel-reg"><p><label class="r-right" for="rr-username">帐号</label><input data-rule="username" name="login_account" type="text" class="r-dialog-text" id="rr-username" /><span class="r-dialog-ico"></span></p><p class="r-dialog-tip"></p><p><label class="r-right" for="rr-password">密码</label><input data-rule="password" data-strict_="same,continual" name="password" type="password" class="r-dialog-text" id="rr-password" /><span class="r-dialog-ico"></span></p><p class="r-dialog-tip"></p><p><label class="r-right" for="rr-rpassword">确认密码</label><input data-rule="eq" data-target="#rr-password" name="rpassword" data-error="两次密码不一致" type="password" class="r-dialog-text" id="rr-rpassword" /><span class="r-dialog-ico"></span></p><p class="r-dialog-tip"></p>{realname}<p class="r-dialog-protocol"><input class="r-checkbox" type="checkbox" checked data-rule="checkbox" id="r-dialog-protocol" /><label for="r-dialog-protocol">我已阅读并同意</label><a href="http://my.37.com/user_agreement.html" target="_blank">《用户注册服务协议》</a><span class="r-dialog-ico"></span><p class="r-dialog-tip"></p></p><p class="ac"><a href="#" id="tj-r-btn-reg" class="btn btn-s-2">接受协议并注册</a></p></div></div>',realName:'<p><label class="r-right" for="rr-realname">真实姓名</label><input name="name" data-rule="realname" type="text" class="r-dialog-text" id="rr-realname" /><span class="r-dialog-ico"></span></p><p class="r-dialog-tip"></p><p><label class="r-right" for="rr-card">身份证号码</label><input name="id_card_number" data-rule="card" type="text" class="r-dialog-text" id="rr-card" /><span class="r-dialog-ico"></span></p><p class="r-dialog-tip"></p>',verify:'<p><label class="r-right" for="rr-safe-code">验证码</label><input maxlength="4" name="safe_code" data-rule="code" type="text" class="r-dialog-text" style="width:100px;margin-right:15px;" id="rr-safe-code"><img class="r-dialog-verify-img" class="safe-code" src="" alt="点击更新验证码" title="点击更新验证码"><span class="r-dialog-ico"></span></p><p class="r-dialog-tip"></p>',loginVerify:'<p><label class="r-right" for="r-verify-code">验证码</label><input maxlength="4" type="text" name="safe_code" data-rule="code" class="r-dialog-text" style="width:100px;margin-right:8px;" id="r-verify-code"><img class="r-dialog-verify-img" class="safe-code" alt="点击更新验证码" title="点击更新验证码"><span class="r-dialog-ico"></span></p>'},regExp:{account:/^\w{4,20}$/i,password:/^[a-zA-Z0-9`~!-@#$%^&*()_+|{}\[\];':"<>?,.\/]{6,20}$/},cookie:{account:"37wan_account",refer:"37wanrefer",passport:"passport_37wan_com"},logInfo:{action:"login",login_account:"",password:"",ajax:0,remember_me:1,save_state:0,ltype:1},regInfo:{action:"save",login_account:"",password:"",password1:"",ajax:0,email:"",name:"",id_card_number:"",save_state:1,phone:"",verify_code:"",refer:"",abrefer:"www.37.com"},userInfo:null,_action:function(a,b){var c,d,e,f=this,g={};return"reg"===a&&(b.abrefer=b.abrefer||b.adrefer||SQ.cookie(SQ.Login.cookie.refer)),$.extend(g,this[a+"Info"],b),abrefer&&"reg"===a&&(g.abrefer=abrefer),d=!!g.dialog,delete g.dialog,verifyCode&&(g.save_code=verifyCode),e=f[a+"Url"],window.bHTTPSEnabled!==!0&&(e=e.replace("https","http")),c={type:"GET",url:e,dataType:"jsonp",data:g,timeout:1e4,success:function(b){if(0===b.code)isLogin=!0,verifyCode="",L.userInfo=TL.prototype.userInfo=b.data,SQ.cookie("zone")||SQ.cookie("zone","cn",{domain:"37.com",path:"/",expires:365}),"log"===a?L.trigger("loged",b.data,d?"dialog":"log",b,g):L.trigger("reged",b.data,d?"dialog":"reg",b,g);else{if(g.gameid&&1===g.ltype&&"safe_true"===b.data&&!d)return loc.href=L.loginPageUrl+"?vvv=1&url="+encodeURIComponent(loc.href);if(1===g.ltype&&-12===b.code)return loc.href=b.data+"?vvv=1&url="+encodeURIComponent(loc.href);"log"===a?L.trigger("unlog",b,d?"dialog":"log",g):L.trigger("unreg",d?"dialog":"reg",b,g)}},error:function(a,b,c){SQ.log&&SQ.log(b),"timeout"!==b?(SQ.log&&SQ.log(b),L.trigger("fail",a,b,c)):L.trigger("timeout",a,b,c)}},$.ajax(c)},_action2:function(a,b){var c={dataType:"jsonp",url:this[a+"Url"]};if("function"==typeof b)return SQ.log&&SQ.log("sq.login2: "+a+" 请统一绑定事件");c.data=b||{},c.data.gameid=c.data.gameid||L.logInfo.gameid||0;var d=SQ.cookie(this.cookie.passport),e={msg:"info"===a?"未曾登录":"还未登录，不能注销",code:"info"===a?-109:-108};return d&&"logout"!==d?$.ajax(c).done(function(b){0===b.code?"info"===a?(isLogin=!0,L.userInfo=TL.prototype.userInfo=b.data,L.trigger("loged",b.data,"info",b,c)):(isLogin=!1,L.userInfo=TL.prototype.userInfo=null,L.trigger("out",b)):"info"===a?L.trigger("unlog",b,"info",c):L.trigger("unout",b,c)}).fail(function(a,b,c){L.trigger("fail",a,b,c)}):void setTimeout(function(){L.trigger("unlog",e,a,e)},0)},toLog:function(a){return this._action("log",a)},toReg:function(a){return this._action("reg",a)},toOut:function(a){return this._action2("out",a)},getUserInfo:function(a){this._action2("info",a)},checkUsername:function(a,b){return a=$.trim(a),""===a?"帐号不能为空":b&&!this.regExp.account.test(a)?"帐号由4~20数字、字母或下划线组成":!b&&/<.*\/?>/.test(a)?"帐号有无效字符":!0},checkPassword:function(a,b){return a=$.trim(a),""===a?"密码不能为空":this.regExp.password.test(a)?!0:b?"请输入正确的密码":"密码由6~20位数字、字母或特殊字符组成"},getUsername:function(a){if(a){var b=SQ.cookie(this.cookie.account,{path:"/",domain:"37.com"});a=$(a),b&&a.val(b)}},refreshCode:function(a){a&&$(a).prop("src",this.codeUrl+"?t="+$.now())},existAccount:function(a,b,c){if(a){var d=this;return b=b||$.noop,c=c||$.noop,$.ajax({url:this.existAccountUrl,dataType:"jsonp",data:{login_account:a},success:function(a){b.call(d,a)},fail:function(a){c.call(d,a)}})}},checkWords:function(a,b,c,d){if(a){var e=this;return c=c||$.noop,d=d||$.noop,b=b||"default",$.ajax({url:this.checkWordsUrl,dataType:"jsonp",data:{words:a,field:b},success:function(a){c.call(e,a)},fail:function(a){d.call(e,a)}})}},hasLogin:function(){return isLogin},alert:function(a){SQ.alert?SQ.alert(a):alert(a)},pwdStrength:function(a){return/(^\d+$)|(^[a-z]+$)/i.test(a)?1:a.length>=8&&/\d+/.test(a)&&/[a-z]+/i.test(a)&&/[-`~!@#$%^&*()_+|{}\[\];':"<>?,.\/]+/.test(a)?3:2}},SQ.Events),VC=new SQ.Class,VC.include({checkCodeUrl:"http://my.37.com/code_check.php?callback=?",init:function(a){var b=this.options=$.extend(!0,{},{logBox:null,template:"",type:"log",showVC:function(){return $(b.template).insertAfter(b.logBox.find("["+b.placeholder+"]:first"))},placeholder:"data-vc",state:{normal:"log-verify-ico",right:"log-verify-ico-right",error:"log-verify-ico-error",pending:"log-verify-ico-pending"},checked:$.noop,open:$.noop,close:$.noop},a);this.showVC=b.showVC},_events:function(){var a=this;this.codeImg=this.codeTip.find("img").prop("src",L.codeUrl+"?"+$.now()).on("click",function(){L.refreshCode(this)}),this.codeInput.on("keyup",function(b){var c;if(13!==b.keyCode)if(c=this.value,4===c.length){if(!/^[A-Za-z0-9]{4}$/.test(c))return a._state("error");if("pending"===a.currentState)return;a._state("pending"),$.getJSON(a.checkCodeUrl,{save_code:c}).done(function(b){0===b.code?(verifyCode=c,a._state("right"),a.options.checked.call(a)):(verifyCode="",a._state("error"))}).fail(function(){verifyCode=""})}else"right"===a.currentState&&a._state("error")}).data("vc",this)},refreshImg:function(){this.codeImg&&(L.refreshCode(this.codeImg),this._state("error"))},check:function(){var a=this.codeInput.val();return"right"===this.currentState?!0:a&&/^[A-Za-z0-9]{4}$/.test(a)&&"error"!==this.currentState?void 0:(this._state("error"),!1)},_state:function(a){var b=this.options.state,c=this.$state;c||(c=this.$state=this.codeTip.find("."+b.normal).eq(0)),this.currentState&&c.removeClass(b[this.currentState]),c.addClass(b[this.currentState=a])},open:function(){var a,b=this.codeTip;b||(b=this.codeTip=this.showVC(this.options),a=this.codeInput=b.find("input"),this._events(),"log"===this.options.type&&setTimeout(function(){a.focus()},10),this.isOpen=!0,this.options.open&&this.options.open.call(this,this.options))},close:function(){this.codeTip&&(this.codeTip.remove(),this.codeImg.off(),this.codeInput.off(),this.$state=this.currentState=this.codeImg=this.codeInput=this.codeTip=null,this.isOpen=!1,this.options.close&&this.options.close.call(this,this.options))}});var s=null,lDialog=new SQ.Class;lDialog.include({$w:$(window),isShow:!1,defaults:{active:0,hideId:!1,zIndex:1e3,exCss:!0,logSuccess:$.noop,logFail:$.noop,regSuccess:$.noop,regFail:$.noop},init:function(a){this.options=a||{}},_init:function(){var a=this.opts=$.extend({},this.defaults,this.options),b=this;if(a.exCss&&$head.append(L.css.dialogEx),$head.append(L.css.dialog.replace("{zindex}",a.zIndex).replace("{zindex1}",a.zIndex+1)),$(document.body).append(L.tpl.dialog.replace("{realname}",a.hideId?"":L.tpl.realName)),a.$cover=$("#r-cover"),a.$dialog=$("#r-dialog"),!a.$dialog.length)return SQ.log&&SQ.log("LoginDialog: 似乎没有 dom 结构");this.$tabs=this.opts.$dialog.find(".r-dialog-t a"),this.$panels=this.opts.$dialog.find("div.r-dialog-panel"),this.$logError=this.$panels.eq(0).find("p.r-dialog-tip:first"),this.$regError=this.$panels.eq(1).find("p.r-dialog-tip:first"),this.$regRNError=$("#rr-realname").parent().next();var c=this.opts.$dialog.find("a.btn-s-2");this.$btnLog=c.eq(0),this.$btnReg=c.eq(1),this._change(this.opts.active),this._events(),SQ.Login.getUsername(this.$username=$("#r-username")),this.$password=$("#r-password"),this.vc=new VC({logBox:this.$panels.eq(0),template:L.tpl.loginVerify,state:{normal:"r-dialog-ico",right:"r-dialog-ico-right",error:"r-dialog-ico-error",pending:"r-dialog-ico-pending"},checked:function(){this.codeInput.removeClass("r-dialog-text-error"),b.$logError.text("")}}),this.regVC=new VC({logBox:this.$panels.eq(1),template:L.tpl.verify,type:"reg",state:{normal:"r-dialog-ico",right:"r-dialog-ico-right",error:"r-dialog-ico-error",pending:"r-dialog-ico-pending"},checked:function(){this.codeInput.removeClass("r-dialog-text-error").parent().next().removeClass("r-dialog-verify-error").text("")},showVC:function(a){return $(a.template).insertBefore(a.logBox.find("p.r-dialog-protocol"))}}),SQ.Qrcode&&(this.qr=new SQ.Qrcode({elem:"#sq-qr-top",insetContent:{name:"top",options:{elem:"top"}},initFun:function(){var a=$(this.options.elem);a.parent().css({zoom:"1"}).end().find(SQ.Qrcode.$divQrMain).height(a.parent().height())}}),this.qr.bind("loginSuc",function(){location.reload()}),this.qr.bind("showed",function(a){a.elem.indexOf("top")>0&&$(a.elem).find(SQ.Qrcode.$divQrMain).height($(a.elem).parent().height())}))},_events:function(){var a=this;a.opts.$dialog.on("click.sq.login",".r-dialog-t a",function(b){if(b.preventDefault(),!(this.className.indexOf("focus")>-1)){var c=this.getAttribute("data-order");a._change(c,!0)}}).on("click.sq.login",".r-dialog-close",function(b){b.preventDefault(),a.hide()}).on("keydown.sq.login","input",function(b){if(13===b.keyCode){if(a.$panels.find("input:focus").trigger("focusout"),this.className.indexOf("error")>-1)return;a["_get"+(0===a.order?"Login":"Register")]()}27===b.keyCode&&a.hide()}).on("click.sq.login","a.btn",function(b){b.preventDefault(),"马上登录"===this.innerHTML?a._getLogin():a._getRegister()}).on("focusout.sq.login",".r-dialog-text",function(b){b.preventDefault();var c=this.getAttribute("data-rule");if(c&&a._validate[c]){var d=a._validate.checkField(this,c,a),e=d===!0;"rr-username"===this.id&&e&&a.remote&&a.remote.inValid===this.value?a._validate.toggleError(this,!1,a.remote.msg,a.$regError):"rr-realname"===this.id&&e&&a.remoteN&&a.remoteN.inValid===this.value?a._validate.toggleError(this,!1,a.remoteN.msg,a.$regRNError):a._validate.toggleError(this,e,e?"":d,0===a.order?a.$logError:$(this).parent().next())}}),a.$panels.eq(0).on("focusin.sq.login",".r-dialog-text-error",function(){var b=$.data(this,"message");b&&a.$logError.text(b)}),a.$panels.eq(1).on("focusin.sq.login focusout.sq.login",".r-dialog-text:not(.r-dialog-text-error)",function(b){a._regFieldTip($(this),"focusout"===b.type)}).on("change.sq.login","#r-dialog-protocol",function(){var b=this.getAttribute("data-rule"),c=$(this).parent().next();if(b&&a._validate[b]){var d=a._validate.checkField(this,b,a),e=d===!0;a._validate.toggleError(this,e,e?"":d,c)}});var b;a.$w.on("scroll.sq.login resize.sq.login",function(c){clearTimeout(b),b=setTimeout(function(){a._resize(!0,"resize"===c.type)},300)}),L.bind("loged",a.opts.logSuccess),L.bind("loged",function(){return a.ignoreFocusValidate=!1,a.$panels.eq(0).find(":password").val(""),a.$btnLog.removeClass("pending").text("马上登录"),a.hide("loged"),a.$btnLog.removeClass("pending"),a.vc.close(),!1});var c,d={"-1":"请输入正确的帐号","-2":"请输入正确的密码"};L.bind("unlog",a.opts.logFail),L.bind("unlog",function(b,e){a.$btnLog.removeClass("pending").text("马上登录"),"dialog"===e&&(a.opts.logFail.call(a,b),c||(c={"-1":a.$username,"-2":a.$password}),c[b.code]?(a._validate.toggleError(c[b.code].focus(),!1,d[b.code],a.$logError),c[b.code][0].select()):"safe_true"!==b.data||-7!==b.code&&-11!==b.code?(a.vc.isOpen&&a.vc.refreshImg(),SQ.Login.alert(b.msg||"登录出错，请重新尝试！")):a.vc.isOpen?(a._validate.toggleError(a.vc.codeInput.focus(),!1,"验证码错误",a.$logError),a.vc.codeInput[0].select(),a.vc.refreshImg()):a.vc.open())}),L.bind("reged",a.opts.regSuccess),L.bind("reged",function(){a.ignoreFocusValidate=!1,a.$panels.eq(1).find(":password").val(""),a.$btnReg.text("接受协议并注册"),a.hide("reged"),a.remote&&delete a.remote,a.remoteN&&delete a.remoteN,a.regVC.close()}),L.bind("unreg",a.opts.regFail),L.bind("unreg",function(b,c){a.$btnReg.text("接受协议并注册"),c&&-10===c.code&&a.regVC.open(),c&&-23===c.code?a.$regError.html(c.msg):c&&-24===c.code?a.$regRNError.html(c.msg):a.$regError.html(c.msg)})},_change:function(a,b){this.$tabs.removeClass("focus").eq(a).addClass("focus"),this.$panels.hide().eq(a).show(),this._resize(b),this.order=+a,this._showRepeat(this.$panels.eq(a))},_getLogin:function(){var a=this.$btnLog;if(!a.hasClass("pending")){var b,c=this,d=this.$username.val(),e=this.$password.val(),f=$("#r-dialog-keep").prop("checked")?1:0,g=this._validate.check(this.$panels.eq(0),this.$logError,c);g?(b={login_account:d,password:e,save_state:f,dialog:!0},c.options.gameid&&(b.gameid=c.options.gameid),a.addClass("pending").text("登录中..."),c.ignoreFocusValidate=!0,SQ.Login.toLog(b,"dialog")):a.removeClass("pending").text("马上登录")}},_getRegister:function(){var a={},b=this,c=this.$panels.eq(1),d=this._validate.check(c,this.$regError,b);!d||b.pending||b.pendingN?d||b.$btnReg.text("接受协议并注册"):(this.$btnReg.text("注册中..."),c.find("input").each(function(){a[this.name]=this.value}),b.options.gameid&&(a.gameid=b.options.gameid),a.dialog=!0,b.ignoreFocusValidate=!0,SQ.Login.toReg(a))},_validate:{checkAccount:function(a,b){var c=$(a),d=c.next(),e=a.value,f=$.data(a,"valid"),g=$.data(a,"invalid");return b.remote||(b.remote={}),b.remote.inValid=g,b.remote.valid=f,f===e?void(b.remote.state=!0):g===e?void(b.remote.state=!1):(b.pending=!0,d.toggleClass("r-dialog-ico-right r-dialog-ico-pending"),void SQ.Login.checkWords(e,"account").done(function(c){c&&(-1===c.code?(d.removeClass("r-dialog-ico-pending"),b._validate.toggleError(a,!1,b.remote.msg=c.msg,b.$regError),b.remote.state=!1,$.data(a,"invalid",e)):SQ.Login.existAccount(e,function(c){c&&(-1!==c.code?(d.removeClass("r-dialog-ico-pending").addClass("r-dialog-ico-right"),b.remote.state=!0,$.data(a,"valid",e),b._validate.toggleError(a,!0,"",b.$regError),delete b.pending):(d.removeClass("r-dialog-ico-pending"),b._validate.toggleError(a,!1,b.remote.msg=c.msg,b.$regError),b.remote.state=!1,$.data(a,"invalid",e)))}))}))},checkRealname:function(a,b){var c=$(a),d=c.next(),e=a.value,f=$.data(a,"validN"),g=$.data(a,"invalidN");return b.remoteN||(b.remoteN={}),b.remoteN.inValid=g,b.remoteN.valid=f,f===e?void(b.remoteN.state=!0):g===e?void(b.remoteN.state=!1):(b.pendingN=!0,d.toggleClass("r-dialog-ico-right r-dialog-ico-pending"),void SQ.Login.checkWords(e,"name").done(function(c){c&&(-1===c.code?(d.removeClass("r-dialog-ico-pending"),b._validate.toggleError(a,!1,b.remoteN.msg=c.msg,b.$regRNError),b.remoteN.state=!1,$.data(a,"invalidN",e)):(d.removeClass("r-dialog-ico-pending").addClass("r-dialog-ico-right"),b.remoteN.state=!0,$.data(a,"validN",e),b._validate.toggleError(a,!0,"",b.$regRNError),delete b.pendingN))}))},check:function(a,b,c){var d=this,e=!0;return a.find("input").each(function(){var a=this.getAttribute("data-rule");if(c.order&&(b=$(this).parent().next()),a&&d[a]){var f=d.checkField(this,a,c),g=f===!0;d.toggleError(this,g,g?"":f,b),e&&(e=g)}}),setTimeout(function(){var a=$(b[0].parentNode),c=a.find(".r-dialog-text-error:focus");c.length?c.trigger("focus"):a.find(".r-dialog-text-error:first").focus().trigger("focus")},10),e},checkField:function(a,b,c){var d="rr-username"===a.id,e=this[b].call(a,a.value,d);return d&&e===!0&&(this.checkAccount(a,c),e=c.remote.state?e:c.remote.msg),"rr-realname"===a.id&&e===!0&&(this.checkRealname(a,c),e=c.remoteN.state?e:c.remoteN.msg),e},toggleError:function(a,b,c,d){var e=$(a),f=e.data("$mess");f||(f=e.siblings("span.r-dialog-ico"),e.data("$mess",f)),b?(d.removeClass("r-dialog-tip-error"),$(a).removeClass("r-dialog-text-error"),f.length&&f.removeClass("r-dialog-ico-error").addClass("r-dialog-ico-right")):(d.addClass("r-dialog-tip-error"),$(a).addClass("r-dialog-text-error"),f.length&&f.removeClass("r-dialog-ico-right").addClass("r-dialog-ico-error")),d.html(c),$.data(a,"message",c)},username:function(a,b){return SQ.Login.checkUsername(a,b)},password:function(a){var b=SQ.Login.checkPassword(a,"r-password"===this.id),c={same:function(a){return/^([a-zA-Z0-9`~!-@#$%^&*()_+|{}\[\];':"<>?,.\/])\1{5,19}$/.test(a)?"密码不能全为相同字符":!0},continual:function(a){for(var b,c,d=!0,e=!0,f=1,g=a.length;g>f;f++)b=a.charAt(f-1),c=a.charAt(f),d&&String.fromCharCode(b.charCodeAt()+1)!=c&&(d=!1),e&&String.fromCharCode(b.charCodeAt()-1)!=c&&(e=!1);return d||e?"密码不能为连续字符":!0}};if(b===!0){var d=this.getAttribute("data-strict");if(d)for(var e=d.split(","),f=0;f<e.length;f++){var g=c[e[f]];if(g&&(b=g.call(this,a)),b!==!0)return b}}return b},eq:function(a){return""===a?"请确认密码":$(this.getAttribute("data-target")).val()!==a?"输入的密码不一致":!0},checkbox:function(){return this.checked?!0:"请阅读注册协议并勾选同意"},card:function(a){var b="身份证号无效，如 440106198202020555";if(!a)return"请输入身份证号，如 440106198202020555";if(!/^[0-9xX]+$/.test(a))return b;if(15!==a.length&&18!==a.length)return b;var c,d,e,f,g,h,i={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},j=a.split("");if(null==i[parseInt(a.substr(0,2),10)])return b;switch(a.length){case 15:e=(parseInt(a.substr(6,2),10)+1900)%4===0||(parseInt(a.substr(6,2),10)+1900)%100===0&&(parseInt(a.substr(6,2),10)+1900)%4==0?/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,e.test(a)||(h=b);break;case 18:e=parseInt(a.substr(6,4),10)%4===0||parseInt(a.substr(6,4),10)%100===0&&parseInt(a.substr(6,4),10)%4===0?/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,e.test(a)?(f=7*(parseInt(j[0],10)+parseInt(j[10],10))+9*(parseInt(j[1],10)+parseInt(j[11],10))+10*(parseInt(j[2],10)+parseInt(j[12],10))+5*(parseInt(j[3],10)+parseInt(j[13],10))+8*(parseInt(j[4],10)+parseInt(j[14],10))+4*(parseInt(j[5],10)+parseInt(j[15],10))+2*(parseInt(j[6],10)+parseInt(j[16],10))+parseInt(j[7],10)+6*parseInt(j[8],10)+3*parseInt(j[9],10),c=f%11,g="F",d="10X98765432",g=d.substr(c,1),g!=j[17].toUpperCase()&&(h=b)):h=b}return h||!0},realname:function(a){return/^[\u4e00-\u9fa5]+$/.test(a)?!0:"请输入真实姓名，如 张三"},phone:function(a){return""===a?"手机号码不能为空":/^0?(13[0-9]|15[0-35-9]|18[012356789]|14[57]|17[0678])[0-9]{8}$/.test(a)?!0:"输入的手机号码无效"},code:function(a){var b=$(this).data("vc");return""===a?"验证码不能为空":b?b.check()?!0:"请输入正确的验证码":/^[A-Za-z0-9]{4}$/.test(a)?!0:"请输入的正确的验证码"},mail:function(a){return""===a?"邮箱不能为空":/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a)?!0:"输入的邮箱无效"},grade:function(a){var b,c,d="",e=["弱","中","强"],f="<span class='pwd-grade pwd-grade-bg-{grade}'></span>",g="<span class='pwd-grade-{grade}'>{text}</span>";for(b=17>=a?1:a>=26?3:2,c=0;b>c;c++)d+=f.replace("{grade}",b);for(c=0;3-b>c;c++)d+=f.replace("{grade}",0);return d+g.replace("{grade}",b).replace("{text}",e[b-1])},score:function(pwd){var score=0,regexArr=["[0-9]","[a-z]","[A-Z]","[\\W_]"],repeatCount=0,prevChar="",i,num,len=pwd.length;for(score+=len>20?20:len,i=0,num=regexArr.length;num>i;i++)eval("/"+regexArr[i]+"/").test(pwd)&&(score+=4);for(i=0,num=regexArr.length;num>i;i++)pwd.match(eval("/"+regexArr[i]+"/g"))&&pwd.match(eval("/"+regexArr[i]+"/g")).length>=2&&(score+=2),pwd.match(eval("/"+regexArr[i]+"/g"))&&pwd.match(eval("/"+regexArr[i]+"/g")).length>=5&&(score+=2);for(i=0,num=pwd.length;num>i;i++)pwd.charAt(i)==prevChar?repeatCount++:prevChar=pwd.charAt(i);return score-=repeatCount}},show:function(a){var b=this;b.parseTemplate?b._show(a):(b.parseTemplate=!0,b._init(),setTimeout(function(){b._show(a)},1))},_show:function(a){this.opts.$cover.height($(document).height()).show(),this.opts.$dialog.show(),this.isShow=!0,$.getJSON(SQ.Login.verifyUrl).done($.proxy(function(a){1===a.code&&this.regVC.open()},this)),L.trigger("dialogshow"),"number"==typeof a&&this.order!=a?this._change(a):this._showRepeat(this.$panels.eq(a))},_regFieldTip:function(a,b){var c,d={login_account:"4-20位字母、数字或下划线",password:"6-20位字母、数字或特殊字符",rpassword:"请确认密码",name:"请输入真实姓名",id_card_number:"请输入身份证号",safe_code:"请输入验证码"};return b?a.parent().next().text(""):(c=d[a[0].name],void(c&&a.parent().next().text(c)))},_showRepeat:function(a){setTimeout(function(){a.find("input").filter(function(){return""===this.value&&"checkbox"!==this.type}).eq(0).focus()},100)},_getTop:function(){return document.documentElement.scrollTop||document.body.scrollTop},_resize:function(a,b){var c=this.$w.height(),d=this.opts.$dialog.outerHeight(!0),e=(c-d)/2,f=this._getTop();this.opts.$dialog[a?"animate":"css"]({top:e+f}),b&&this.opts.$cover.height($(document).height())},hide:function(a){this.isShow&&(this.opts.$cover.hide(),this.opts.$dialog.hide(),this.isShow=!1,L.trigger("dialoghide",a))},bind:function(a,b){L.bind(a,b)}}),SQ.Login.Dialog=function(a){return s&&a&&$.extend(s.options,a),s||(s=new lDialog(a))}}}(jQuery,SQ),function(a,b,c){var d,e=window.location,f={version:"1.2.2",Track:{},Trigger:{url:"http://a.clickdata.37wan.com/controller/istat.controller.php",defaults:{platform:"37wan",item:"",game_id:"",sid:"",position:"",ext_1:"",ext_2:"",ext_3:"",ext_4:"",ext_5:"",ext_6:"",login_account:"",browser_type:"",user_ip:""}},convertMap:{baidu_pinpai:"baidu_ppzq"},getDocReferrer:function(a){var b="",c=a||document.referrer;return c&&(b=c.split("://")[1].split("/"),b=a?b[0]+"/"+b[1]:b[0]),b},convertPathToDomain:function(a){var b="",c=/^www.37.com\/([0-9a-z]+)$/;return a=this.getDocReferrer(a),c.test(a)&&(b=a.split("/")[1]+".37.com"),b},addDom:function(b,c,d){c=c||"script",this.d&&d&&document.body.removeChild(this.d),b&&(this.d=document.createElement(c),"script"===c?this.d.type="text/javascript":this.d.style.display="none",this.d.src=b+(b.indexOf("?")>-1?"&t=":"?t=")+a.now(),document.body.appendChild(this.d))},referCookie:"37wanrefer",setReferer:function(a){var c,d,f,g,h,i,j,k,l,m,n=document.referrer,o=e.search,p=/^https?:\/\/(?:www|search)\.(baidu|soso|sogou|google|so|youdao|jike|panguso).+(?:\?|&)(?:wd|q|query)=([^&]+)/;if(/(\?|&)(source|refer(er)?)=\S+/.test(o)){for(h=["refer","uid","ad_param","wd","ad_type"],i=0,j=h.length,g=[],l=b.queryToJson(o),i;j>i;i++)c=l[h[i]],0===i&&(c=c||l.referer||l.source,c=this.convertMap[c]||c),2===i&&(c=c||l.ab_param),4===i&&(c=c||l.ab_type),g.push(c||"");g=g.join("|")}else k=this.getDocReferrer(),k?(f=k.split("."),d=f.length,"37.com"!==f.splice(d-2,2).join(".")?(m=p.exec(n),g=m&&m[1]&&m[2]?k+"|||"+m[2]+"|":k):g=""):g=a?this.convertPathToDomain(e.href):e.host;
return g&&b.cookie(this.referCookie,g,{path:"/",domain:"37.com"}),g},getReferer:function(){return b.cookie(this.referCookie)},updateReferer:function(a,c){var d=this.getReferer();d&&(d=d.split("|"),d[a]=c,b.cookie(this.referCookie,d.join("|"),{path:"/",domain:"37.com"}))},hasAdReferer:function(a){var b=this.getReferer();return/(\?|&)(source|refer(er)?)=\S+/.test(a||e.href)||b&&b.indexOf("|")>-1&&-1===b.split("|")[0].indexOf(".")},delReferer:function(){b.cookie(this.referCookie,null,{path:"/",domain:"37.com"})},setADcookie:function(){a("body").append("<div style='display:none'><img src='http://cm.he2d.com/1/' /></div>")}};f.Source=b.Class.create({dataUrl:"http://ptres.37.com/js/sq/modules/game_source.js",sourceCookie:"37tg_param",init:function(c,e,f,g){var h=b.cookie(this.sourceCookie),i=b.getParam("source");this.cookieParam=b.queryToJson(h),this.param=f||[],this.$link=c,this.source=i||this.cookieParam.source,g=g||this.dataUrl,c&&c.length&&e&&this.source&&a.getScript(g,a.proxy(function(){this.targetUrl=d[e][this.source],h?this._getCookie():this._setCookie()},this))},_getCookie:function(){delete this.cookieParam.source,this._setBtn(this.cookieParam)},_setCookie:function(){b.cookie(this.sourceCookie,"?source="+this.source+"&"+this._parseParam(),{path:"/"}),this._setBtn()},_setBtn:function(a){this.$link.prop("href",this._addParam(a))},_addParam:function(a){return this.targetUrl?this.targetUrl.indexOf("?")>-1?this.targetUrl+"&"+this._parseParam(a):this.targetUrl+"?"+this._parseParam(a):b.log&&b.log("注册按钮：找不到对应的 url ")},_parseParam:function(c){var d,e=0,f=this.param,g=f.length;if(c=c||{},a.isEmptyObject(c))for(;g>e;e++)d=f[e],c[d]=b.getParam(d);return a.param(c)}},{getSource:function(a){d=a}}),f.Track.Ad=b.Class.create({param:["click_type","web_r"],adUrl:"http://www.37.com/test/checkin.php",paramReferrer:"web_urlrefer",init:function(a,b){this.url=b||e.href,this.param=a||this.param,this._parseParam(this.param)},_parseParam:function(a){for(var c,d=0,e=a.length,g={};e>d;d++)c=a[d],g[c]=b.getParam(c,this.url);g[this.paramReferrer]=f.getDocReferrer(),this._request(g)},_request:function(b){f.addDom(this.adUrl+"?"+a.param(b))}}),f.Trigger.Download=b.Class.create({init:function(c,d,e){this.downLoadUrl=e||c.attr("data-url"),c.on("click",a.proxy(function(c){if(c.preventDefault(),"string"==typeof d)return void this._download(d);var e=a.extend({},f.Trigger.defaults,d);return e.item?void this._download(f.Trigger.url+"?"+a.param(e)):b.log&&b.log("没有统计关键参数 item")},this))},_download:function(a){f.addDom(a),f.addDom(this.downLoadUrl,"iframe")}}),f.Trigger.Click=b.Class.create({init:function(b,c){b.on("click",a.proxy(function(d){var e=b.attr("target");if(a.nodeName(b[0],"a")&&!e&&(d.preventDefault(),this.refresh=b[0].href),"string"==typeof c)return void this._request(c);var g=a.extend({},f.Trigger.defaults,c);return g.item?void this._request(f.Trigger.url+"?"+a.param(g)):alert("没有统计关键参数 item")},this))},_request:function(a){f.addDom(a),this.refresh&&(e.href=this.refresh,this.refresh="")}}),f.Trigger.Load=b.Class.create({init:function(b){if("string"==typeof b)return void this._request(b);var c=a.extend({},f.Trigger.defaults,b);return c.item?void this._request(f.Trigger.url+"?"+a.param(c)):alert("没有统计关键参数 item")},_request:function(a){f.addDom(a)}}),f.ImgStatis=b.Class.create({statis:function(){b.log(this.opt.e4);var c=this.url+"?"+a.param(this.opt),d=new Image;d.src=c},init:function(c,d,e){return"object"!=typeof c?void b.log("param error!"):(this.url=d||"http://pt.clickdata.37.com/ps.gif",this.interval=e||60,this.opt={la:"",gid:"",sid:"",e1:"",e2:"",e3:0,e4:0,e5:1,e6:"",e7:"",ext:""},a.extend(this.opt,c),(!this.opt.e4||isNaN(this.opt.e4))&&(this.opt.e4=0),void this.run())},run:function(){var a=this;a.statis(),a.opt.e4+=a.interval,window.setTimeout(function(){a.run()},1e3*this.interval)}}),f.Online=b.Class.create({init:function(c){if("object"!=typeof c)return void b.log("param error!");var d=a.extend({},{login_account:"",game_server_id:"",ext:""},c);if(!d.login_account||!d.game_server_id)return void b.log("没有统计关键参数 login_account或game_server_id");this.interval=6e4,d.login_account=encodeURIComponent(d.login_account),d.game_server_id=parseInt(d.game_server_id,10);var e="http://ol.37wan.com/checkin?"+a.param(d);this.run(e)},run:function(a){f.addDom(a,"script",1);var b=this;window.setTimeout(function(){b.run(a)},b.interval)}}),b.Statis=f;var g=b.byId("sq-statis-refer");g&&b.Statis.setReferer(g.getAttribute("data-path")),a(document).ready(function(){b.Statis.setADcookie()})}(jQuery,SQ),function(a,b,c){var d,e=window.document,f=b.Qrcode=new b.Class(b.Widget);f.include({init:function(c){var d,e=this.options=a.extend(!0,{},{elem:null,autoOpen:!1,content:"",insetContent:null,initFun:null},c);return e.elem?(d=a(e.elem),void(d.length&&(this._insetContent(),this._content(),this._render(),this._events(),this.trigger("created"),e.autoOpen&&this.open()))):b.log("SQ.Qrcode：目标元素？")},_events:function(){var b=this,c=a(this.options.elem);c.on("click.sw",".sq-qr-switch",function(a){a.preventDefault(),b.change(this)}).on("click.refresh",".sq-qr-refresh",function(a){a.preventDefault(),c.find(f.$divQrContent).show().next().hide(),b._showImg()}).on("mouseenter.altimg",".sq-qr-img img",function(c){c.preventDefault(),b.options.elem.indexOf("www")>0||a(".sq-qr-altimg").show()}).on("mouseleave.altimg",".sq-qr-img img",function(b){b.preventDefault(),a(".sq-qr-altimg").hide()})},_render:function(){this.options;d||(f.$style=a(f.css.common).appendTo(e.head||a("head")),d=!0)},_insetContent:function(){var c,d=this.options,e=d.insetContent;e&&(c=f.tpl)&&!a.isEmptyObject(e.options)&&(d.content=b.T(c,e.options))},_content:function(){var b,c=this.options,d=c.insetContent;c.content&&!f["$style"+d.name]&&(b=this.options.elem.indexOf("top")>0?c.content.replace("{$alttpl}",f.altTpl):c.content.replace("{$alttpl}",""),f["$style"+d.name]=a(f.css[d.name]).appendTo(e.head||a("head")),f["$tpl"+d.name]=a(c.elem).html(b),c.initFun&&c.initFun.call(this))},change:function(b){a(b).hasClass("sq-qr-switch-on")?(a(b).removeClass("sq-qr-switch-on"),this._hideImg()):(a(b).addClass("sq-qr-switch-on"),this._showImg(),f.clickStatis(this.options.insetContent.name))},_showImg:function(){var b=this,c=b.options;a(c.elem).find(f.$divQrMain).show(),this.trigger("showed",c),a.ajax({url:f.getTokenUrl,dataType:"jsonp",success:function(d){0===d.ret&&(a(c.elem).find(f.$divQrImg).find("img").prop("src",f.getImageUrl+"&token="+d.token+"&t="+a.now()).css({width:"124px",height:"124px"}),window.onlyQrclass=c.elem,b._interval(d.token))}})},_hideImg:function(){var b=this,c=b.options;a(c.elem).find(f.$divQrMain).hide().find(f.$divQrContent).show().next().hide(),window.clearInterval(b.timeInterval)},_interval:function(a){var b=this;f.countNum=0,f.timeoutNum=0,window.onlyToken=a,this.timeInterval=window.setInterval(function(){return window.onlyQrclass!==b.options.elem?(window.clearInterval(b.timeInterval),void b._msgfail("fail","","sameQr")):void(f.countNum*f.heartbeat<f.failure?b._valid(a):(window.clearInterval(b.timeInterval),b._msgfail("fail","","count")))},1e3*f.heartbeat)},_valid:function(b){var c=this;return f.timeoutNum>2?(window.clearInterval(c.timeInterval),void c._msgfail("fail","网络超时","out")):void a.ajax({url:f.isValidUrl,data:{token:b,pos:c.options.insetContent.name},dataType:"jsonp",success:function(a){if(0===a.ret)2===a.actype?(window.clearInterval(c.timeInterval),c.trigger("loginSuc")):(f.failure=f.failure+f.sucEnd,f.countNum+=1,c._msgsuc());else if(-11===a.ret||-21===a.ret||-25===a.ret)f.countNum+=1;else{window.clearInterval(c.timeInterval);var b=a.msg;if(-12===a.ret||-14===a.ret)return void c._msgfail("err2","登录限制","err2");if(-13===a.ret)return void c._msgfail("err","登录已被限制","err");-22===a.ret?b="登录失败":(-1===a.ret||-26===a.ret)&&(b=""),c._msgfail("fail",b,"fail")}},error:function(a,b,c){f.countNum+=1,"timeout"===b&&(f.timeoutNum+=1)}})},_showMsg:function(c,d,e,g){var h=this.options,i=b.T(f.msgTpl,{type:c,msgTil:e||"二维码已失效",ret:g||0});i=i.replace("{$msgCon}",d),a(h.elem).find(f.$divQrContent).hide().next().show().html(i)},_msgsuc:function(){this._showMsg("success",f.message.suc,"扫描成功")},_msgfail:function(a,b,c){this._showMsg("error",f.message[a],b,c)}}),f.extend({getTokenUrl:"http://qrcode.37.com/api/login.php?a=get_token",getImageUrl:"http://qrcode.37.com/api/login.php?a=get_code_img",isValidUrl:"http://qrcode.37.com/api/login.php?a=code_login",clickStatisUrl:"http://pt.clickdata.37wan.com/ps.gif?id=8&at=3&ext=",$divQr:".sq-qr",$divQrMain:".sq-qr-main",$divQrImg:".sq-qr-img",$divQrContent:".sq-qr-content",$divQrMessage:".sq-qr-message",heartbeat:2,failure:118,sucEnd:0,css:{common:'<style type="text/css">.sq-qr-main {display:none;}.sq-qr-switch {position:absolute;right:0;display:block;background:url("http://img1.37wanimg.com/www/css/images/common/qr/qr-switch.png") no-repeat;_background-image:url("http://img1.37wanimg.com/www/css/images/common/qr/qr-switch-8.png");_font-size:0;}.sq-qr-head {padding:20px 20px 10px;font-size:18px;display:none;font-weight:bold}.sq-qr-main {position:absolute;background:#fff;color:#6c6c6c;text-align:center;}.sq-qr-content .span {color:#17a1ed;}.sq-qr-content p {padding:20px 0;}.sq-qr-img img {width:124px;height:124px;}.sq-qr-message {padding:54px 0 0;display:none;}.sq-qr-msg {height:24px;padding:0 0 0 34px;background:url("http://img1.37wanimg.com/www/css/images/common/qr/qr-ico.png") no-repeat;_background-image:url("http://img1.37wanimg.com/www/css/images/common/qr/qr-ico-8.png");font-size:18px;color:#3c3c3c;_font-size:20px;}.sq-qr-success {background-position: 0 0;}.sq-qr-error {background-position: 0 -30px;}.sq-qr-msg-p {margin:30px 0 0;font-size:14px;color:#6c6c6c;}.sq-qr-refresh, .sq-qr-link {color:#17a1ed;}.sq-qr-altimg {position:absolute;display:none;}</style>',www:'<style type="text/css">.sq-qr-www .sq-qr-switch{width:30px;height:30px;top:0;background-position: -10px 0;}.sq-qr-www .sq-qr-switch-on {background-position: -10px -40px;}.sq-qr-www .sq-qr-main {width:248px;top:31px;left:1px;}</style>',top:'<style type="text/css">.sq-qr-top .sq-qr-switch{width:40px;height:40px;bottom:0;background-position: 0 -160px;}.sq-qr-top .sq-qr-switch-on {background-position: 0 -200px;}.sq-qr-top .sq-qr-main {width:392px;height:226px;top:0;left:0;}.sq-qr-top .sq-qr-altimg {width:135px;height:143px;right:0;top:60px;background:url("http://img1.37wanimg.com/www/css/images/common/qr/s_shadow.png") no-repeat;_background-image:url("http://img1.37wanimg.com/www/css/images/common/qr/s_normal.png");}</style>',log:'<style type="text/css">.sq-qr-log .sq-qr-switch{width:40px;height:40px;top:0;background-position: 0 -80px;}.sq-qr-log .sq-qr-switch-on {background-position: 0 -120px;}.sq-qr-log .sq-qr-head {display:block;color:#3c3c3c;text-align:left;}.sq-qr-log .sq-qr-main {width:336px;height:290px;top:0;left:2px;}.sq-qr-altimg {width:286px;height:286px;left:50%;top:50%;margin:-120px 0 0 -60px;background:url("http://img1.37wanimg.com/www/css/images/common/qr/l_shadow.png") no-repeat;_background-image:url("http://img1.37wanimg.com/www/css/images/common/qr/l_normal.png");}</style>'},tpl:'<div class="sq-qr-main"><div class="sq-qr-head">扫一扫登录</div><div class="sq-qr-content"><p>请使用<a href="http://lp.37.com/" target="_blank" class="span">37游戏令牌</a>手机app扫描二维码</p><div class="sq-qr-img"><img src="" alt="" title=""/></div></div><div class="sq-qr-message"></div></div><a class="sq-qr-switch" data-qr="{$elem}" title="切换登录" href="javascript:;"></a>{$alttpl}',msgTpl:'<span class="sq-qr-msg sq-qr-{$type}" data-ret="{$ret}">{$msgTil}</span><p class="sq-qr-msg-p">{$msgCon}</p>',altTpl:'<div class="sq-qr-altimg"></div>',message:{suc:"请根据app中的提示完成操作",fail:'请<a class="sq-qr-refresh">点此刷新二维码</a>后重试',err:"请在20分钟后再尝试登录",err2:'如有疑问请<a href="http://kf.37.com/" target="_blank" class="sq-qr-link">联系客服</a>'},show:function(){a(b.Qrcode.$divQr).show()},hide:function(){a(b.Qrcode.$divQr).hide()},clickStatis:function(a){var c={www:"leftup",top:"float",log:"indep"},d=b.Qrcode.clickStatisUrl,e=new Image;c[a]&&(d=d+c[a]+"&t="+Math.random(),e.src=d)}})}(jQuery,SQ),function(a,b,c){var d=new c.Class(c.Widget);d.include({init:function(b){this.options={el:"body",tabs:"li",panels:"div",eventType:"click",index:0,auto:!1,interval:5e3,animate:{show:"show",hide:"hide"},currentClass:"focus"},a.extend(this.options,b||{}),this.el=a(this.options.el),this.tabs=a(this.options.tabs,this.el),this.panels=a(this.options.panels,this.el),this.el.attr("data-kid",this.id),this.change(this.options.index),this._events(),this.options.auto&&this.auto()},change:function(a){var b=this.options.currentClass;this.tabs.filter("."+b).removeClass(b),this.tabs.eq(a).addClass(b),this.panels.hide().eq(a)[this.options.animate.show](),this.currentIndex=a,this.trigger("change",a,this)},_events:function(){this.tabs.bind(this.options.eventType,this.proxy(this._eventHandler)),this.options.auto&&(this.tabs.bind("mouseenter",this.proxy(this.stop)),this.tabs.bind("mouseleave",this.proxy(this.auto)),this.panels.bind("mouseenter",this.proxy(this.stop)),this.panels.bind("mouseleave",this.proxy(this.auto)))},_eventHandler:function(a){var b=a.currentTarget;if(!(b.className.indexOf(this.options.currentClass)>-1)){var c=0;return this.tabs.each(function(a){return b===this?(c=a,!1):void 0}),this.change(c),!1}},auto:function(){this.timerId=b.setInterval(this.proxy(this._autoHandler),this.options.interval),this.trigger("auto",this)},_autoHandler:function(){var a=this.currentIndex+1;a>=this.tabs.size()&&(a=0),this.change(a)},stop:function(){this.timerId&&(b.clearInterval(this.timerId),this.trigger("stop",this))},_destroying:function(){this.stop(),this.el.removeAttr("data-kid"),this.tabs.unbind(this.options.eventType),this.panels.unbind()}}),c.Tab=d}(jQuery,window,SQ),function(a,b,c){var d=new c.Class(c.Widget);d.include({init:function(b){this.setting={title:null,buttons:null,mask:!0,type:"html",content:"",width:600,height:300,appendTo:document.body,autoShow:!0,classStyle:""},a.extend(this.setting,b),this.render(),this.events(),this.setting.autoShow&&this.show()},events:function(){a(window).resize(this.proxy(this.position)),this.el.on("click.sq.dialog",".sq-dialog-btn[href^=javascript]",this.proxy(this._buttonsHandler)).on("click.sq.dialog",".sq-dialog-close",this.proxy(this.hide))},_buttonsHandler:function(b){b.preventDefault();var c=a(b.target),d=c.attr("data-name"),e=this.setting.buttons[d];e&&("function"==typeof e&&e(b,this,d),e.fn&&"function"==typeof e.fn&&e.fn(b,this,d))},render:function(){if(!this.el){var b='<div style="display:none;"></div>';this.el=a(b),this.el.appendTo(a(this.setting.appendTo)),this.el.attr("data-kid",this.id)}var d='<div class="sq-dialog-masking" style="height:{$docHeight}px;"></div>',e='<div class="sq-dialog {classStyle}" style="width:{$width}px;left:{$left}px;top:{$top}px;">                                <div class="sq-dialog-avatar"></div>                                <div style="position:relative;">                                    <div class="sq-dialog-body">                                        <div class="sq-dialog-titlebar {$notitle}">                                            <span class="sq-dialog-titlebar-text">{$title}</span>                                            <a href="javascript:void(0);" title="关闭" class="sq-dialog-close">关闭</a>                                        </div>                                        <div class="sq-dialog-client">                                            <div class="sq-dialog-content" style="height:{$contentHeight}px;">                                                {%=content%}                                            </div>                                        </div>                                        <div class="sq-dialog-buttons {$nobutton}">                                           {%=buttons%}                                        </div>                                    </div>                                </div>                            </div>';e=e.replace("{classStyle}",this.setting.classStyle);var f=c.template((this.setting.mask?d:"")+e,this._renderObj());this.el.html(f),this.position()},position:function(){var b=a(".sq-dialog-masking",this.el),c=a(".sq-dialog",this.el),d=a(".sq-dialog-titlebar",this.el),e=a(".sq-dialog-buttons",this.el),f=a(window),g=c.width(),h=this.setting.height+e.outerHeight(!0)+d.outerHeight(!0)+100,i=f.width(),j=f.height(),k=document.documentElement.scrollTop||document.body.scrollTop;b.height(a(document).height()),c.css({left:Math.abs(i-g)/2,top:Math.abs(j-h)/2+k})},_buttons:function(){var a=[];if(this.setting.buttons&&c.isObject(this.setting.buttons)){var b='<a class="sq-dialog-btn btn btn-s-1 {$cls}" {$target} href="{$href}" data-name="{$name}">{$name}</a>';for(var d in this.setting.buttons){var e=this.setting.buttons[d],f="javascript:;",g="";"string"==typeof e&&(f=e,g="target='_blank'"),a.push(c.template(b,{cls:e.cls||"",name:d,href:e.href||f,target:e.target||g}))}}return a.join("")},_renderObj:function(){var b=a(window),d=this.setting.width,e=this.setting.height||400,f=b.width(),g=b.height();return{docHeight:a(document).height(),width:this.setting.width,contentHeight:e,left:(f-d)/2,top:(g-e)/2,title:this.setting.title||"",notitle:this.setting.title?"":"sq-dialog-notitle",nobutton:c.isObject(this.setting.buttons)?"":"sq-dialog-nobutton",content:this._getContent(),buttons:this._buttons()}},_getContent:function(){var b=this.setting.content,c="";switch(this.setting.type){case"html":"object"==typeof b?(c=a(b).html(),a(b).empty()):c=b;break;case"iframe":c='<iframe allowtransparency="true" frameborder="0" src="'+b+'" width="100%" height="'+(this.setting.height-10)+'"></iframe>';break;case"ajax":c='<div class="sq-dialog-loading"><p>正在努力加载...</p></div>',a.get(b,this.proxy(this.setContent))}return c},setContent:function(b){var c=a(".sq-dialog-content",this.el);c.html(b)},show:function(a){a&&this.el.find(".sq-dialog-titlebar-text").text(a),this.el.show(),this.position(),this.trigger("show",this)},hide:function(){this.el.hide(),this.trigger("hide",this)},_destroying:function(){a(".sq-dialog-btn",this.el).unbind(),this.el.remove()}}),c.Dialog=d,c.alert=function(a,b,d){return new c.Dialog({title:d||"提示信息",buttons:{"确定":function(a,c){b&&b(),c.destroy()}},content:"<div class='sq-dialog-alert'>"+a+"</div>",type:"html",width:300,height:70})},c.confirm=function(a,b,d){return new c.Dialog({title:"提示信息",buttons:{"确定":function(a,c){b&&b(),c.destroy()},"取消":function(a,b){d&&d(),b.destroy()}},content:a,type:"html",width:360,height:70})},c.tip=function(a){var b=new c.Dialog({title:null,buttons:null,content:a,type:"html",width:400,height:40,mask:!1});return setTimeout(function(){b.destroy()},3e3),b},c.loading=function(b,d){d=d||a.noop,b=b||"正在加载数据，请稍后...","function"==typeof b&&(d=b,b="正在加载数据，请稍后...");var e=new c.Dialog({title:"提示信息",buttons:{"取消加载":function(a,b){b.hide()}},content:'<div class="sq-dialog-loading"><span>'+b+"</span></div>",type:"html",width:400,height:60});return e.bind("hide",function(){d.call(e),e.destroy()}),e}}(jQuery,window,SQ),function(a,b){var c=new b.Class(b.Widget),d=0;c.include({version:"1.2.2",win:a(window),location:{rightBottom:{right:0,bottom:0},leftBottom:{left:0,bottom:0},centerLeft:{top:0,left:"center-500"},centerRight:{top:0,left:"center+500"},center:{top:0,left:"center"},leftMiddle:{top:"center",left:0},rightMiddle:{top:"center",right:0},centerMiddle:{top:"center",left:"center"}},init:function(b){var c=this.options=a.extend({},{location:"rightBottom",element:null,debug:!1},b);return c.element?(c.element=a(c.element),c.element.length?("string"==typeof c.location&&(c.location=a.extend({},this.location[c.location])),c.element.data("fixed")?this:(this._guid=d++,this._parseLocation(c,c.location),this._fixed(c),void(this._supportFixed()||this.win.trigger("scroll")))):void(c.debug&&alert("没有找到元素"))):void(c.debug&&alert("没有需要定位的元素"))},_parseLocation:function(b,c){var d,e=c.top,f=c.left,g=b.element.outerWidth(),h=b.element.outerHeight();if(f&&!a.isNumeric(f)){if(-1===f.indexOf("center"))return void(b.debug&&alert("位置无效"));"center"===f?(c.left="50%",c.marginLeft=-g/2,c.right="auto"):(d=+/center((?:\+|-)\d+)/.exec(f)[1],0>d?(c.left="50%",c.marginLeft=d-g,c.right="auto"):d>0&&(c.right="50%",c.marginRight=-d-g,c.left="auto"))}if(e&&!a.isNumeric(e)){if(-1===e.indexOf("center"))return void(b.debug&&alert("位置无效"));"center"===e?(c.top="50%",c.marginTop=-h/2,c.bottom="auto"):(d=+/center((?:\+|-)\d+)/.exec(e)[1],0>d?(c.top="50%",c.marginTop=d-h,c.bottom="auto"):d>0&&(c.bottom="50%",c.marginBottom=-d-h,c.top="auto")),this._parseLocationIE6(e,c,d,h)}},_parseLocationIE6:function(a,b,c,d){if(!this._supportFixed()){this.t||(this.t=a,this.l=b,this.offset=c,this.height=d),a||(a=this.t,b=this.l,c=this.offset,d=this.height);var e=this.win.height();"center"===a?(b.top=(e-d)/2,b.marginTop="auto"):0>c?(b.top=(e-d)/2-c,b.marginTop="auto"):c>0&&(b.top=(e-d)/2+c,b.marginTop="auto",b.bottom="auto")}},_fixed:function(b){var c=this._supportFixed();b.element.css(a.extend({},b.location,{position:c?"fixed":"absolute"})).data("fixed",!0),this._hackIE6(b,c)},_hackIE6:function(b,c){if(!c){var d,e=this,f=e.win.height(),g=b.element.outerHeight();a("<style type='text/css'> * html{overflow-x:hidden;background:url(about:blank) no-repeat fixed;}</style>").appendTo("head"),this.win.on("scroll.fixed"+this._guid,function(){b.element.css({bottom:"auto",top:document.documentElement.scrollTop+(a.isNumeric(b.location.bottom)?f-g-b.location.bottom:b.location.top)})}).on("resize.fixed"+this._guid,function(){clearTimeout(d),setTimeout(function(){b.element.css(b.location),a.isNumeric(b.location.bottom)&&b.element.css("top","auto"),f=e.win.height()},120)})}},_destroying:function(){this.win.off("resize.fixed"+this._guid)},_supportFixed:function(){return-1===(window.navigator.userAgent||"").toLowerCase().indexOf("msie 6")}}),b.Fixed=c}(jQuery,SQ),function(a,b,c,d){function e(a,b){return j||(j=new f(a,b))}function f(b,c){this.$wrap=a("#gs-top"),this.gameid=b,this._getPubData(),c.top=c.top||{},c.top.$log=a("#g-top-login"),c.top.$loged=a("#g-top-loged"),this.login=c,this._events(),this.shortCut(b)}var g=null,h=window.location,i=b.Game=new b.Class;i.include({init:function(c){var d=this.options=a.extend(!0,{},{gConfig:{},$log:null,logedTpl:i.tpl.logedTpl,$loginFrame:null,gameid:0,gameName:"",dialog:!0,regDialog:!0,regDialogExc:null,regBtn:"#btn-reg",outBtn:"#logout",top:!0,enterGameDialog:!0,fixedUrl:"http://www.37.com/html/game_fixed.js"},c);return d.gameid=d.gameid||d.gConfig.id,d.gameid?(d.gameName=d.gameName||d.gConfig.name,d.gameName?(this.$doc=a(document),d.dialog=d.dialog||d.top||!!this.$doc.find("a[data-role='server']").length,this.gameid=d.gameid,this.gameName=d.gameName,d.$loginFrame&&d.$loginFrame.length&&(this.$log=d.$log,this.$loginFrame=d.$loginFrame,d.text=["您上次进入的服是：","37"+d.gameName+"推荐您进入："]),(d.dialog||d.$loginFrame&&d.$loginFrame.length)&&this._log(),d.top&&(this.top=new e(d.gameid,this.login)),this._statis(d),this._events(d),this.server={},void(d.fixedUrl&&"index"===d.gConfig.page&&this._getFixed(d.fixedUrl))):b.log&&b.log("SQ.Game： gameName ？")):b.log&&b.log("SQ.Game： gameid ？")},_events:function(a){var c=this,d=function(a){a||(g=null,b.Login.unbind("dialoghide",d))};this._logEvents(c),a.enterGameDialog&&c.$doc.on("click","a[data-role=server]",function(a){c.login.hasLogin()||(a.preventDefault(),c.login.dialog.show(0),g=this,c.login.dialog.bind("dialoghide",d))})},_log:function(){var a,c=this,d=c.options,e=b.Statis.hasAdReferer()&&d.regDialog;a=this.login=new b.Login({gameid:d.gameid,dialog:d.dialog||e,dialogOpts:{hideId:e},lr:function(a){return g?void(h.href=g.href):void c._logParse(a)},unlog:function(a,b){"log"===b&&a.msg&&i.alert(a.msg)},out:function(){b.GameCornerTip.delCookie("ct_account_37_com"),c._logToOut()},loged:function(a){new b.GameCornerTip({account:a.LOGIN_ACCOUNT,cookieName:"is_dts_bind",url:"http://my.37.com/user/is_dts_bind.php",tplFun:function(a,b){return"1"==a.data?b.template='<div style="color:#13677e;font-size:12px;padding:15px 10px 0;line-height:1.8;height:100px;"><p>您在平台绑定的密保手机号码为{phon}，如非您本人手机号码，请尽快进行<a href="http://kf.37.com/index.php?c=repair_account&a=guide" target="_blank" title="" style="color:#ff8700;">账号修复</a>。</p></div>'.replace("{phon}",a.msg):b.template='<div style="color:#13677e;font-size:12px;padding:15px 10px 0;line-height:1.8;height:75px;"><p>您在游戏里验证过多个手机号码，为加强您的账号安全，请尽快到平台绑定唯一密保手机号码。</p></div><div class="t-corner-tip-footer"><a href="http://my.37.com/user/userprotect.php#3" target="_blank" title="我要绑定">我要绑定</a></div>',b}}),new b.GameCornerTip({account:a.LOGIN_ACCOUNT,cookieName:"is_point_clear",url:"http://shop.37.com/api/point_clear_api.php?action=notify",tipOption:{tipWidth:295,tipHeight:174,count:0,wrapTitle:"积分即将到期",url:"http://huodong.37.com/zt/platform/20151221/?=media",template:{name:"tplswf",options:{src:"http://img1.37wanimg.com/www/swf/point_clear.swf",src2:"http://img1.37wanimg.com/www/swf/point_clear.swf",href:"http://huodong.37.com/zt/platform/20151221/?=media",statis:"http://pt.clickdata.37wan.com/ps.gif?id=12&la={login_account}&gid={from_game_id}&ext=&e1={url}".replace("{login_account}",a.LOGIN_ACCOUNT).replace("{from_game_id}",g_config.id).replace("{url}",encodeURIComponent("http://huodong.37.com/zt/platform/20151221/?=media"))}}}})}}),a.getUserInfo()},_logEvents:function(a){a.$doc.on("click",this.options.outBtn,function(b){b.preventDefault(),a.login.toOut()})},_logToOut:function(){this.$loged&&(this.$loged.remove(),this.$loged=null,this.$log.show())},_logParse:function(b){var c,d,e,f=this.options,g=b.HISTORY_HOT_GAMESERVER,h="暂未开服，敬请期待",i="javascript:alert('暂未开服，敬请期待')",j="";f.$loginFrame&&f.$loginFrame.length&&(d=f.text[g.length?g[0].HOTSORT:1],g.length&&(h=g[0].SERVER_NAME,i=g[0].SERVER_URL,j="target='_blank'"),c=f.logedTpl.replace("{$username}",b.LOGIN_ACCOUNT).replace("{$date}",b.LAST_LOGIN_TIME).replace("{$serverurl}",i).replace("{$servername}",h).replace("{$text}",d).replace("{$serverblank}",j),"function"==typeof f.parseTpl&&(e=f.parseTpl.call(this,c)),e&&"string"==typeof e&&(c=e),this.$loged=a(c).appendTo(f.$loginFrame),this.$log.hide().find(":password").val(""))},_statis:function(c){var d,e=!0,f=this,g=c.regDialogExc;c.regDialog&&(b.Statis.setReferer(c.gConfig.secDir),b.Statis.hasAdReferer()&&(d=b.Statis.getReferer(),g&&a.each(g,function(a,b){return d.indexOf(b)>-1?(e=!1,!1):void 0}),e&&this.login.bind("unlog",function(b,d){"info"===d&&a(document).on("click",c.regBtn,function(a){a.preventDefault(),f.login.dialog.show(1)})})))},_getFixed:function(b){a.getScript(b)},getCard:function(a){return i.getCard(this.gameid,a)},getWechat:function(a){return i.getCard(this.gameid,a,"wechat")},getServerList:function(c,d){var e,f,g,h;c&&(e=this,c.elem&&(f=a(c.elem)),c.tpl&&(g=a(c.tpl)),c.server_type&&(h=+c.server_type),i.getServerList(this.gameid,c.limit).done(function(a){var d,j=a.data,k=[],l=0;if(j&&(d=j.length)){for(;d>l;l++)j[l].NAME=j[l].SERVER_NAME,j[l].SERVER_START_TIME=j[l].START_TIME,h?j[l].SERVER_TYPE==h&&k.push(j[l]):k.push(j[l]);e.server.max||e.trigger("maxserver",e.server.max=i.getMaxServer(k)),f&&g&&e.parseServerList(f,g,k.slice(0,c.limit)),e.trigger("serverlist",k,c)}else b.log&&b.log(a.msg||"SQ.Game: 没有开服。不用理会这个信息。")}))},getOtherServerList:function(a){this.getServerList(a,!0)},parseServerList:function(a,c,d){d&&a.html(b.T(c.html(),d))},fastIn:function(a,b){if(a&&b){var c=this.options;this.bind("maxserver",function(d){a.val(d).attr("data-maxid",d),b.prop("href",i.getEnterGameUrl(c.gameid,d)),i.fastIn(this.options.gameid,a,b,d)})}}}),i.include(b.Events),i.extend({tpl:{logedTpl:'<div class="loged"><div class="loged-top">用户信息</div><div class="loged-panel"><ul><li>您好，<a class="loged-highlight" class="_blank" href="http://my.37.com/user/">{$username}</a></li><li><a target="_blank" href="http://my.37.com/user/userprotect.php">完善密保资料</a></li><li>登录时间：<span class="loged-highlight">{$date}</span></li><li>{$text}</li><li><a href="{$serverurl}" {$serverblank}>{$servername}</a></li><li class="loged-usercenter f-ar"><a target="_blank" href="http://my.37.com/user/">用户中心</a><a href="javascript:;" id="logout">注销</a></li></ul></div><div class="loged-bottom"></div></div>'},serverOption:{game_id:-1,state:0,page:1,page_size:0},url:{card:"http://gameapp.37.com/controller/card.php?callback=?",server:"http://gameapp.37.com/controller/game_servers.php?callback=?",enterGame:"http://game.37.com/play.php?game_id={$gameid}&sid={$sid}",serverlist:"http://ptres.37.com/content/cache/game_server/{$gameid}.js"},alert:function(a){a=a||"获取数据失败，请尝试刷新页面^o^",b.alert?b.alert(a):alert(a)},serverListXHR:null,getServerList:function(c){return 0>=c?b.log&&b.log("SQ.Game: 服务器列表没传 gameid ？"):this.serverListXHR||(this.serverListXHR=a.ajax({url:this.url.serverlist.replace("{$gameid}",c),dataType:"jsonp",jsonpCallback:"game_server_callback_"+c}))},getCard:function(b,c,d){var e;return d=d||"card",e="wechat"===d?{action:"get_weixin_card",gameid:b,card_key:c}:{gameid:b,sid:c},a.getJSON(this.url.card,e).fail(function(){i.alert()})},getEnterGameUrl:function(a,b){return a&&b?i.url.enterGame.replace("{$gameid}",a).replace("{$sid}",b):void 0},fastIn:function(a,b,c,d){var e,f=function(){var f=+b.val();0>=f||"number"==typeof d&&f>d?(c.prop({target:"_self",href:"javascript:;"}),e=!1):(e=!0,c.prop({target:"_blank",href:i.getEnterGameUrl(a,f)}))};f(),b.on("keyup",function(){f()}),c.on("click",function(a){e||(a.preventDefault(),i.alert("输入的服数无效或者该服暂未开通"))})},getMaxServer:function(a){if(a&&a.length){var b=0,c=a.length,d=-1;if(1===c)d=+a[b].SID;else for(;c>b;b++)if("2"===a[b].STATE){d=+a[b].SID;break}return 0>d&&a&&a[0].SID&&(d=+a[0].SID),d}},bookMark:function(a,b){var d=a||location.href,e=b||document.title;try{c.external.AddFavorite(d,e)}catch(f){try{c.sidebar.addPanel(e,d,"")}catch(f){i.alert("请您尝试同时按下Ctrl和D键收藏本页")}}},setHome:function(a){if(a&&a.nodeName)try{a.style.behavior="url(#default#homepage)",a.setHomePage(location.href)}catch(b){i.alert("您的浏览器不支持此操作！\n请您手动设置主页")}},_parseFixed:function(b){b&&a(b).appendTo(document.body)},historyToTpl:function(b){return a.map(b,function(a){return{STATE:a.STATE,NAME:a.SERVER_NAME,SID:a.SID}})}});var j;a.extend(f.prototype,b.Events,{url:{header:"http://ptres.37.com/content/cache/header.js",pub:"http://ptres.37.com/content/cache/game_site_header/{$gameid}.js",baidu:"http://bdtg.37.com/direct_media/call_back?/cb/4/1723/20732.js?uid=",baiduClick:"http://bdtg.37.com/s/4/1723/20732/3.js?uid=",shortcut:"http://www.37.com/shortcut.php?game_id={$gameid}"},mapOfMoreState:{hot:'<span class="g-top-new"></span>',"new":'<span class="g-top-hot"></span>'},tpl:{moreState:'<a target="_blank" href="{$url}">{$name}{$state}</a>',pub:'<a target="_blank" title="{$title}" href="{$url}"><img src="{$img}" alt="{$alt}" /></a>'},isMoreOpen:!1,isMarkOpen:!1,isPubOpen:!1,_getPubData:function(){if(this.gameid){var c=this;a.ajax({url:c.url.pub.replace("{$gameid}",this.gameid),cache:!1,dataType:"jsonp",jsonpCallback:"content_callback_game_site_header_"+this.gameid}).done(function(a){1===a.code&&(c._parsePub(a.data),c._baiduStatis())}).fail(function(){b.log&&b.log("SQ.Game: 获取数据失败")})}},_getMoreData:function(){var c=this;a.ajax({url:this.url.header,cache:!1,dataType:"jsonp",jsonpCallback:"content_callback_header"}).done(function(a){1===a.code&&a.msg&&a.msg.leader_game?c._parseMore(a.msg.leader_game):b.log&&b.log("SQ.Game: 顶部数据异常")}).fail(function(){b.log&&b.log("SQ.Game: 顶部数据异常")})},openMore:function(){this.isMoreOpen||(this.$moreWrap||(this.$moreWrap=a("#g-top-more")),this.$morePanel||(this.$morePanel=this.$moreWrap.find("div.g-top-more-panel:first")),this.$moreTab.addClass("g-top-hover"),this.$moreWrap.show(),this.isMoreOpen=!0,this.trigger("open","more",{panel:this.$morePanel,wrap:this.$moreWrap,tab:this.$moreTab}),this.$moreTab.data("getdata")||this._getMoreData())},closeMore:function(){this.isMoreOpen&&(this.$moreTab.removeClass("g-top-hover"),this.$moreWrap.hide(),this.isMoreOpen=!1,this.trigger("close","more",{panel:this.$morePanel,wrap:this.$moreWrap,tab:this.$moreTab
}))},_parsePub:function(b){var c,d=this.$pubSmall=a("#g-top-pub"),e=this.$pubLarge=a("#g-top-pub-large"),f=b.top_img[0],g=b.top_img[1],h=function(a,b){return b.tpl.pub.replace("{$title}",a.text).replace("{$alt}",a.text).replace("{$url}",a.link||"javascript:;").replace("{$img}",a.img)};c=-1===f.img.indexOf(".swf")?h(f,this):'<embed width="100%" height="100%" quality="high" type="application/x-shockwave-flash" wmode="transparent" src="'+f.img+'" />',d.html(c),e.html(h(g,this)),this.hasParsePub=!0},_parseMore:function(a){var b,c=0,d=["<div>"];if(a){for(b=a.length;b>c;c++)0!==c&&c%10===0&&d.push("</div><div>"),d.push(this.tpl.moreState.replace("{$url}",a[c].site_index).replace("{$name}",a[c].name).replace("{$state}",this.mapOfMoreState[a[c].game_hot_new]||""));d.push('<a target="_blank" class="g-top-more-panel-more" href="http://game.37.com/">更多游戏</a></div>'),this.$morePanel.html(d.join("")).removeClass("g-top-loading"),this.$moreTab.data("getdata",!0)}else this.close()},_events:function(){var b=this,c=b.login.top;this.$wrap.on("mouseenter mouseleave","a.g-top-more-tab, #g-top-more",function(c){b.$moreTab||(b.$moreTab=a(this)),"mouseenter"===c.type?b.openMore():b.closeMore()}).on("mouseenter mouseleave click","#g-top-mark-menu, a.g-top-mark-tab",function(c){switch(b.$markTab||(b.$markTab=a(this)),b.$markMenu||(b.$markMenu=a("#g-top-mark-menu")),c.type){case"click":this.className.indexOf("g-top-mark-tab")>-1&&c.preventDefault();break;case"mouseenter":b.isMarkOpen||(b.$markTab.addClass("g-top-hover"),b.$markMenu.show(),b.isMarkOpen=!0,b.trigger("open","mark"));break;case"mouseleave":b.isMarkOpen&&(b.$markTab.removeClass("g-top-hover"),b.$markMenu.hide(),b.isMarkOpen=!1,b.trigger("close","mark"))}}).on("mouseenter mouseleave click","#g-top-pub, #g-top-pub-large",function(a){"click"===a.type?b._baiduStatis(!0):b.hasParsePub&&(b.isPubOpen||"mouseenter"!==a.type||"g-top-pub"!==this.id||(b.$pubSmall.hide(),b.$pubLarge.show(),b.isPubOpen=!0),b.isPubOpen&&"mouseleave"===a.type&&"g-top-pub-large"===this.id&&(b.$pubSmall.show(),b.$pubLarge.hide(),b.isPubOpen=!1))}).on("click","#g-top-log, #g-top-reg, #g-top-logout",function(a){a.preventDefault(),"g-top-logout"===this.id?b.login.toOut():b.login.dialog.show("g-top-log"===this.id?0:1)}).on("click","a.g-top-mark-home, a.g-top-mark-bookmark",function(a){a.preventDefault(),this.className.indexOf("home")>-1?i.setHome(this):i.bookMark()}),this.login.bind("out",function(){c.$log.css("display","inline-block"),c.$loged.hide(),c.$account.text("loading..."),c.$vip.text("").removeClass("g-top-loged-vip-on"),c.$mail.removeClass("g-top-mails-on")}),this.login.bind("loged reged",function(d){c.$account||(c.$account=a("#g-loged-id"),c.$mail=c.$loged.find("a.g-top-mails:first"),c.$vip=c.$loged.find(".g-top-loged-vip:first")),c.$account.text(d.LOGIN_ACCOUNT),c.$log.hide(),c.$loged.css("display","inline-block"),d.VIP_DEEP>0&&c.$vip.addClass("g-top-loged-vip-on").text(d.VIP_DEEP);try{setTimeout(function(){a.ajax({url:"http://my.37.com/api/message_api.php?action=is_remind",dataType:"jsonp",timeout:3e3}).done(function(a){a&&0===a.code&&a.data>0&&(c.$mail.addClass("g-top-mails-on"),b.trigger("message",a))})},2e3)}catch(e){}}),a(document).on("click","#g-footer-switch-btn",function(c){c.preventDefault(),a(this).toggleClass("g-footer-switch-up"),b.footMoreData()}).on("mouseenter mouseleave",".g-foot-more-btn, .g-foot-more",function(c){c.preventDefault();var d=a(this),e=a(".g-foot-more");b.hideTimer&&window.clearTimeout(b.hideTimer),d.hasClass("g-foot-more-btn")?"mouseenter"==c.type?(e.hide(),d.parent().parent().next().show()):b.hideTimer=window.setTimeout(function(){d.parent().parent().next().hide()},200):d.hasClass("g-foot-more")&&("mouseenter"==c.type?(e.hide(),d.show()):b.hideTimer=window.setTimeout(function(){d.hide()},200))})},_baiduStatis:function(a){(new Image).src=this.url[a?"baiduClick":"baidu"]+this.gameid},footMoreData:function(){var b=a(".g-footer-row2"),c=b.height(),d=-66;this.footMoreDataOpen?this.footMoreDataOpen=!1:(d=-d,this.footMoreDataOpen=!0),b.animate({height:c+d+"px"},100)},shortCut:function(b){var c=a("#g-top-mark-desk"),d=this.url.shortcut.replace("{$gameid}",b);c.length&&c.prop("href",d)}});var k=b.Game.Card=b.Class();k.include({init:function(c){var d=this.options=a.extend({},{game:null,type:"card",select:"#key-server",showCardElem:"#showcard",btn:"#card-btn-get",input:"#key-wechat"},c);return d.game?void this._init(d):b.log&&b.log("SQ.Game.Card: 需要 game 参数")},_init:function(b){if("card"===b.type){if(this.el=a(b.select),!this.el.length)return;var c=this;i.getServerList(b.game.gameid).done(function(a){c.getServer(a.data)})}else this.el=a(b.input);this.showCardElement=a(b.showCardElem),this.btn=a(this.options.btn),this.btn.data("text",this.btn.text()),this._events()},getServer:function(a){var c=a.length,d=0,e=[];if(!c)return b.log&&b.log("没有服务器列表数据");for(;c>d;d++)e.push('<option value="'+a[d].SID+'">'+a[d].SERVER_NAME+"</option>");this.el.append(e.join(""))},_events:function(){var b=this;this.btn.bind("click",function(c){c.preventDefault(),b._parse(a(this))}),"wechat"===b.options.type&&this.el&&this.el.on("keypress",function(a){13===a.keyCode&&b.btn.trigger("click")})},_parse:function(a){if(!a.hasClass("getting")){var b="card"===this.options.type,c=this.options.game,d=this.el.val(),e=this.showCardElement,f=[0,"领取成功，您的卡号是：<span class='f-red'>{$card}</span>","您上次领取的卡号是：<span class='f-red'>{$card}</span>"];if(b&&(!d||0===d))return void i.alert("请选择您游戏角色所在的对应服务器！");if(!b&&!d)return this.el.blur(),void i.alert("请输入您的序列号！");if(!c.login.hasLogin())return c.login.dialog.show(0);a.addClass("getting"),a.text("领取中..."),c[b?"getCard":"getWechat"](d).done(function(b){1===b.code||2===b.code?e.html(f[b.code].replace("{$card}",b.data.card)):b.msg&&i.alert(b.msg),a.removeClass("getting"),a.text(a.data("text"))}).fail(function(){a.removeClass("getting"),a.text(a.data("text"))})}}});var l=b.GameCornerTip=b.Class();l.include({init:function(c){var d=this.options=a.extend({},{account:"",cookieName:"ct_account_37_com",url:"",tipOption:{},tplFun:function(a,b){return b}},c);return d.account?d.url?(this.account=d.account,l.cookieName=this.cookieName=d.cookieName,this.scriptUrl="http://ptres.37.com/js/sq/widget/sq.cornertip.js?v=20140903",void this._init()):b.log&&b.log("no url"):b.log&&b.log("no account")},_init:function(){var a=this.cookieName,c=this.account,d=b.cookie(a);if(d){var e=d.split("|");if(e[0]&&e[0]==c)return;e[0]&&e[0]!=c&&this._get()}else this._get()},_get:function(){var c=this,d=a(".t-corner-tip");return d.length?window.setTimeout(function(){c._get()},1e4):void a.ajax({url:c.options.url,cache:!1,dataType:"jsonp"}).done(function(a){return a?void c._parse(a):b.log&&b.log("network error")})},saveCookie:function(a){if(this.account&&a){var c=this.account+"|"+a,d=this;b.cookie(d.cookieName,c,{path:"/",domain:"37.com",expires:99999})}},_parse:function(c){var d=c.code,e=this;-1!=d&&-110!=d&&(1==d?(e.options.tipOption=e.options.tplFun.call(e,c,e.options.tipOption),b.CornerTip?e._show():a.getScript(e.scriptUrl,function(){e._show()})):e.saveCookie("0"))},_show:function(){var c=this;new b.CornerTip(a.extend(!0,{},{count:10,url:"",once:!0,zIndex:99999,template:""},c.options.tipOption)),c.saveCookie("1")}}),l.extend({delCookie:function(a){b.cookie(a||l.cookieName,"",{path:"/",domain:"37.com"})}})}(jQuery,SQ,this),$(function(){if(window.g_config&&"index"===window.g_config.page){var a=window.g_config.id||0,b=$("#sq-tip-cornermedia");b.length||$.getScript("http://ptres.37.com/js/sq/widget/sq.tip.js",function(){SQ.Tip.getConfig.id=a,SQ.Tip.pullConfig()})}});