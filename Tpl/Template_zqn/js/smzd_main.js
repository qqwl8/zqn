!function(a,b,c){var d=g_config.url,e=new a.Game({$log:b("#log"),$loginFrame:b("#loginframe"),gConfig:g_config,top:!!b("#gs-top").length,logedTpl:'<div class="loged"><div class="loged-panel"><ul><li>您好，<a class="colored" class="_blank" href="http://my.37.com/user/">{$username}</a></li><li><a target="_blank" href="http://my.37.com/user/userprotect.php">完善密保资料</a></li><li>{$text}</li><li><a class="colored" href="{$serverurl}" {$serverblank}>{$servername}</a></li><li class="loged-usercenter f-ar"><a target="_blank" href="http://my.37.com/user/">用户中心</a>&nbsp;&nbsp;&nbsp;<a href="javascript:;" id="logout">注销</a></li></ul></div></div>'}),f={init:function(){var c=this;c.login.init(),c.serverList(),c.bookMark(),c.kvTop(b("#banner")),c.alert(),c.showVideo(),"index"===g_config.page&&(c.kv(b("#kv")),c.newsTab(b("#news")),c.roleTab(),c.media(),c.setHoverDir.init()),"wechat"===g_config.page&&new a.Game.Card({game:e,type:"wechat"}),"getcard"===g_config.page&&new a.Game.Card({game:e})},alert:function(){b(document).on("click",".alertMsg",function(c){c.preventDefault(),a.alert(b(this).data("msg"))}).on("click",".alert",function(){return a.alert('<p style="text-align: center;">敬请期待</p>'),!1}).on("click",".coming",function(){return b(this).attr("data-coming")?a.alert(b(this).attr("data-coming")):a.alert("敬请期待"),!1})},kvTop:function(b){if(a.Tab&&b&&b.length){var c=new a.Tab({el:b,tabs:".kv-top-num li",panels:".kv-top-img>li",eventType:"mouseenter",auto:!0,interval:5e3,currentClass:"focus"});c.bind("change",function(a){var b=c.panels.eq(a).find("img");b.attr("src",b.data("src"))})}},roleTab:function(){function a(a){f.removeClass("curElem"),b(".r"+c).addClass("curElem"),d.removeClass("r-cur"),b(".role-tab"+a).addClass("r-cur")}var c=0,d=b(".role-tab"),e=b(".role-contain"),f=b(".role-detail");e.on("mouseover",".role-tab",function(){c=b(this).data("index"),a(c)}).on("click",".arrow-left",function(){c=0==c?3:c-1,a(c)}).on("click",".arrow-right",function(){c=3==c?0:c+1,a(c)})},setHoverDir:{init:function(){var a=this;b(".ziliao > div").on("mouseenter.hoverdir, mouseleave.hoverdir",a.hoverDir)},hoverDir:function(a){var c=b(this),d=c.find("div"),e=f.setHoverDir.getDir(c,{x:a.pageX,y:a.pageY}),g=f.setHoverDir.getStyle(e);"mouseenter"===a.type?(d.hide().css(g.from),d.show(0,function(){d.css(g.to)})):d.css(g.from)},getDir:function(a,b){var c=a.width(),d=a.height(),e=(b.x-a.offset().left-c/2)*(c>d?d/c:1),f=(b.y-a.offset().top-d/2)*(d>c?c/d:1),g=Math.round((Math.atan2(f,e)*(180/Math.PI)+180)/90+3)%4;return g},getStyle:function(a){var b,c,d={left:"0px",top:"-100%"},e={left:"0px",top:"100%"},f={left:"-100%",top:"0px"},g={left:"100%",top:"0px"},h={top:"0px"},i={left:"0px"};switch(a){case 0:b=d,c=h;break;case 1:b=g,c=i;break;case 2:b=e,c=h;break;case 3:b=f,c=i}return{from:b,to:c}}},newsTab:function(c){if(a.Tab&&c&&c.length){var e=new a.Tab({el:c,tabs:"#news-tab li",panels:"#news-list>ul",eventType:"mouseenter",auto:!1,currentClass:"cur",animate:{show:"fadeIn"}}),f=b(".news-more");e.bind("change",function(a){var b=e.tabs[a].getAttribute("data-news-more");b&&(b.indexOf("http://")>-1?f.attr("href",b):f.attr("href",d+b+"/"))})}},kv:function(b){if(a.Tab&&b&&b.length){new a.Tab({el:b,tabs:"#kvNav li",panels:"#kvCnt li",eventType:"mouseenter",auto:!0,currentClass:"cur"})}},media:function(){var a=b("#media .scr-li li");a.length&&a&&a.length>1&&b("#media .scr-li").jCarouselLite({auto:2e3,speed:1e3,visible:1,vertical:!0})},login:{init:function(){var b=this.username=a.byId("username");b&&a.Login.getUsername(b),this.event()},event:function(){e.$loginFrame.on("click","#log-btn, #login-btn",function(b){b.preventDefault(),e.login.toLog(f.login.username.value,a.byId("password").value,a.byId("login-btn"===this.id?"remember_me":"remember").checked?1:0,!0)}).on("keypress","#username, #password",function(a){13===a.keyCode&&b("#log-btn, #login-btn").trigger("click")})}},serverList:function(){var c=b("#quick-enter-input");c.length&&e.fastIn(c,b("#quick-enter-click"));var d=b("#sidebar-server");if(d.length&&e.getServerList({limit:4,elem:d,tpl:"#sidebar-server-tpl"}),"serverlist"===g_config.page){var f=new a.ServerPager({pageSize:36,pageFixed:!0,testServer:!0,tpl:{pager:"<li>{$page}服</li>",panel:'<ul class="sq-panel f-cf"></ul>'},tabsOptions:{tabs:".sp-pager li",currentClass:"on"},game:e,special:{338:{filter:function(a){return!1}}}});f.bind("created",function(a){b("#rec-server");e.parseServerList(b("#rec-server"),b("#server-tpl"),"2"==a[0].STATE?a.slice(0,2):a.slice(1,3))})}},showVideo:function(){var c,d=b(".layout"),e=b(".video-alert"),f=b(".video-code");d.css("height",b(document).height()),b(".video-show").on("click",function(g){return g.preventDefault(),(c=b(this).data("src"))?(f.html('<embed width="100%" height="100%" title="视频鉴赏" wmode="transparent" src="http://ptres.37.com/swf/flvplayer.swf" allowfullscreen="true" flashvars="vcastr_file='+c+'&amp;LogoText=smzd.37.com&amp;IsAutoPlay=1" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash">'),d.show(),e.show(),!1):a.alert('<p style="text-align: center">敬请期待</p>')}),b(".video-close").on("click",function(a){return a.preventDefault(),e.hide(),f.html(""),d.hide(),!1})},links:function(){var a=b("#links .scroll-links li");a.length&&a&&a.length>11&&b("#links .con").jCarouselLite({auto:2e3,speed:1e3,visible:11,vertical:!1})},bookMark:function(c,d){b(document).on("click","#bookmark",function(b){b.preventDefault();var e=c||window.location.href,f=d||document.title;try{window.external.AddFavorite(e,f)}catch(b){try{window.sidebar.addPanel(f,e,"")}catch(b){return a.alert("请您尝试同时按下Ctrl和D键收藏本页")}}})}};b(function(){return f.init()})}(SQ,jQuery);